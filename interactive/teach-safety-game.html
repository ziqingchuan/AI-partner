<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小学生实验室安全闯关游戏</title>
    <script src="https://cdn.tailwindcss.com/3.3.3"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    
    <style>
        body {
            font-family: 'Comic Sans MS', 'Marker Felt', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: #1e3a8a;
            overflow-x: hidden;
        }
        
        .game-container {
            background-image: url('https://s.coze.cn/image/FIRlFMwK5_Y/');
            background-size: cover;
            background-position: center;
            min-height: 600px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.6);
            z-index: 0;
        }
        
        .game-element {
            position: relative;
            z-index: 10;
            transition: all 0.3s ease;
            cursor: pointer;
            background-color: white;
            border: 3px solid #cbd5e1;
        }
        
        .game-element:hover {
            transform: scale(1.05);
            border-color: #94a3b8;
        }
        
        .game-element.selected {
            border-color: #64748b;
            background-color: #e0f2fe; /* 选中的选项背景色加深 */
        }
        
        .game-element.correct {
            background-color: rgba(34, 197, 94, 0.2);
            border: 3px solid #22c55e;
        }
        
        .game-element.wrong {
            background-color: rgba(239, 68, 68, 0.2);
            border: 3px solid #ef4444;
        }
        
        .score-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 2px solid #3b82f6;
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.2);
        }
        
        .knowledge-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 2px solid #8b5cf6;
            box-shadow: 0 8px 24px rgba(139, 92, 246, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(249, 115, 22, 0.4);
        }
        
        .btn-confirm {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }
        
        .btn-confirm:disabled {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        
        .character {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: auto;
            z-index: 5;
        }
        
        .bubble {
            position: absolute;
            bottom: 180px;
            right: 180px;
            background: white;
            padding: 15px 20px;
            border-radius: 20px;
            max-width: 200px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            animation: float 3s ease-in-out infinite;
            z-index: 15;
        }
        
        .bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 30px;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 20px solid white;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .progress-bar {
            height: 20px;
            background-color: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .star {
            color: #fbbf24;
            font-size: 24px;
            animation: twinkle 1s ease-in-out infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .game-container {
                min-height: 400px;
            }
            
            .character {
                width: 100px;
            }
            
            .bubble {
                bottom: 120px;
                right: 120px;
                max-width: 150px;
                font-size: 14px;
            }
            
            .game-element {
                transform: scale(0.8);
            }
            
            .game-element:hover {
                transform: scale(0.9);
            }
        }
    </style>
</head>
<body class="min-h-screen py-8 px-4">
    <div class="container mx-auto max-w-6xl">
        <!-- 游戏标题 -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-blue-600 mb-4">
                <i class="fas fa-flask mr-3"></i>小学生实验室安全闯关游戏
            </h1>
            <p class="text-xl text-blue-500">
                学习安全知识，成为实验室小能手！
            </p>
        </header>
        
        <!-- 游戏开始模态框 -->
        <div id="startModal" class="modal active">
            <div class="modal-content text-center">
                <img src="https://s.coze.cn/image/AGQ2tGc-Lck/" alt="实验室安全" class="w-full h-auto rounded-lg mb-6">
                <h2 class="text-3xl font-bold text-blue-600 mb-4">欢迎来到实验室安全闯关！</h2>
                <p class="text-lg text-gray-600 mb-6">
                    在这个游戏中，你需要找出实验室中的正确安全操作，并避免危险行为。<br>
                    每答对一题获得10分，答错一题扣5分。<br>
                    完成所有关卡，成为实验室安全小专家！
                </p>
                <button id="startGameBtn" class="btn-primary">
                    <i class="fas fa-play mr-2"></i>开始游戏
                </button>
            </div>
        </div>
        
        <!-- 游戏结束模态框 -->
        <div id="endModal" class="modal">
            <div class="modal-content text-center">
                <h2 class="text-3xl font-bold text-blue-600 mb-4">恭喜你完成了所有关卡！</h2>
                <div class="mb-6">
                    <p class="text-2xl font-bold" id="finalScore">得分: 0</p>
                    <div id="stars" class="mt-2">
                        <!-- 星星会通过JS动态添加 -->
                    </div>
                </div>
                <p class="text-lg text-gray-600 mb-6" id="resultMessage">
                    你已经掌握了基本的实验室安全知识！
                </p>
                <button id="restartGameBtn" class="btn-secondary">
                    <i class="fas fa-redo mr-2"></i>再玩一次
                </button>
            </div>
        </div>
        
        <!-- 游戏主区域 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 左侧信息区 -->
            <div class="lg:col-span-1 space-y-6">
                <!-- 得分卡片 -->
                <div class="score-card p-6">
                    <h2 class="text-2xl font-bold text-blue-600 mb-4">
                        <i class="fas fa-trophy mr-2"></i>你的得分
                    </h2>
                    <div class="text-center mb-4">
                        <div class="text-5xl font-bold text-blue-500" id="score">0</div>
                        <div class="text-sm text-gray-500">当前关卡: <span id="currentLevel">1</span>/5</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 20%"></div>
                    </div>
                </div>
                
                <!-- 安全知识卡片 -->
                <div class="knowledge-card p-6">
                    <h2 class="text-2xl font-bold text-purple-600 mb-4">
                        <i class="fas fa-lightbulb mr-2"></i>安全小知识
                    </h2>
                    <p class="text-gray-700" id="safetyTip">
                        点击实验室中的物品，学习安全知识！
                    </p>
                </div>
                
                <!-- 操作提示 -->
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg">
                    <h3 class="font-bold text-yellow-800">操作提示</h3>
                    <ul class="mt-2 text-sm text-yellow-700">
                        <li><i class="fas fa-mouse-pointer text-blue-500 mr-1"></i> 点击选择你认为正确的安全操作（可多选）</li>
                        <li><i class="fas fa-check-circle text-green-500 mr-1"></i> 正确选项会变成绿色</li>
                        <li><i class="fas fa-times-circle text-red-500 mr-1"></i> 错误选项会变成红色</li>
                        <li><i class="fas fa-check-double text-green-600 mr-1"></i> 点击确认按钮进入下一题</li>
                    </ul>
                </div>
            </div>
            
            <!-- 右侧游戏区 -->
            <div class="lg:col-span-2">
                <div class="game-container p-6 relative">
                    <!-- 卡通角色 -->
                    <img src="https://s.coze.cn/image/dfQN72wrTl8/" alt="实验室小伙伴" class="character">
                    
                    <!-- 对话气泡 -->
                    <div class="bubble" id="characterDialog">
                        嗨！让我们一起学习实验室安全知识吧！
                    </div>
                    
                    <!-- 游戏元素区域 -->
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-6 h-full flex items-center justify-center">
                        <!-- 游戏元素会通过JS动态生成 -->
                    </div>
                    
                    <!-- 确认按钮 -->
                    <div class="absolute bottom-4 left-0 right-0 flex justify-center">
                        <button id="confirmBtn" class="btn-confirm" disabled>
                            <i class="fas fa-check mr-2"></i>确认答案
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 页脚 -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>created by <a href="https://space.coze.cn" class="text-blue-500 hover:underline">coze space</a></p>
            <p>页面内容均由 AI 生成，仅供参考</p>
        </footer>
    </div>
    
    <script>
        // 游戏数据
        const gameData = [
            {
                level: 1,
                question: "在实验室里，以下哪些是正确的安全操作？",
                elements: [
                    {
                        id: 1,
                        type: 'correct',
                        name: '戴护目镜',
                        icon: 'fas fa-glasses',
                        image: 'https://s.coze.cn/image/Y_yuRjvPtCk/',
                        tip: '在实验室进行实验时，一定要戴上护目镜保护眼睛，防止化学药品或碎片进入眼睛。'
                    },
                    {
                        id: 2,
                        type: 'wrong',
                        name: '触摸高温物体',
                        icon: 'fas fa-temperature-high',
                        image: 'https://s.coze.cn/image/bwVc4p_Wj5g/',
                        tip: '实验室中的高温物体不能直接用手触摸，应该使用隔热手套或夹子，以免烫伤。'
                    },
                    {
                        id: 3,
                        type: 'correct',
                        name: '整理实验台',
                        icon: 'fas fa-sort',
                        image: 'https://s.coze.cn/image/XvN4cX6sMbM/',
                        tip: '实验前要整理好实验台，保持整洁有序，这样可以避免碰倒实验器材造成危险。'
                    }
                ]
            },
            {
                level: 2,
                question: "在实验室里，以下哪些行为是危险的？",
                elements: [
                    {
                        id: 4,
                        type: 'wrong',
                        name: '品尝化学药品',
                        icon: 'fas fa-utensils',
                        image: 'https://s.coze.cn/image/31Ndslo73ko/',
                        tip: '实验室中的任何化学药品都不能品尝，因为它们可能有毒或具有腐蚀性。'
                    },
                    {
                        id: 5,
                        type: 'correct',
                        name: '穿实验服',
                        icon: 'fas fa-user-md',
                        image: 'https://s.coze.cn/image/29PbuaX7B2Y/',
                        tip: '做实验时要穿上实验服，保护自己的衣服和皮肤不被化学药品污染。'
                    },
                    {
                        id: 6,
                        type: 'correct',
                        name: '正确使用灭火器',
                        icon: 'fas fa-fire-extinguisher',
                        image: 'https://s.coze.cn/image/3PCps0LF_LA/',
                        tip: '了解灭火器的位置和使用方法，发生小火灾时可以及时扑灭，避免火势扩大。'
                    }
                ]
            },
            {
                level: 3,
                question: "在实验室里，以下哪些是正确的行为？",
                elements: [
                    {
                        id: 7,
                        type: 'wrong',
                        name: '在实验室奔跑',
                        icon: 'fas fa-running',
                        image: 'https://s.coze.cn/image/Ot6nLpUrAm0/',
                        tip: '在实验室里不能奔跑或追逐打闹，以免碰倒实验器材或撞到其他人，造成危险。'
                    },
                    {
                        id: 8,
                        type: 'correct',
                        name: '洗手',
                        icon: 'fas fa-hand-wash',
                        image: 'https://s.coze.cn/image/0MF8wA5YKZ0/',
                        tip: '实验结束后要彻底洗手，清除手上可能残留的化学药品，保持个人卫生。'
                    },
                    {
                        id: 9,
                        type: 'wrong',
                        name: '混合未知药品',
                        icon: 'fas fa-flask-poison',
                        image: 'https://s.coze.cn/image/R7YARJrn_5g/',
                        tip: '不要随意混合未知的化学药品，因为它们可能会发生剧烈反应，产生有毒气体或爆炸。'
                    }
                ]
            },
            {
                level: 4,
                question: "在实验室里，以下哪些是安全的做法？",
                elements: [
                    {
                        id: 10,
                        type: 'correct',
                        name: '阅读实验说明',
                        icon: 'fas fa-book-open',
                        image: 'https://s.coze.cn/image/Y9AEI20G1mc/',
                        tip: '做实验前一定要仔细阅读实验说明，了解实验步骤和注意事项，确保安全操作。'
                    },
                    {
                        id: 11,
                        type: 'wrong',
                        name: '凑近闻化学药品',
                        icon: 'fas fa-lungs',
                        image: 'https://s.coze.cn/image/Mg71KexZG44/',
                        tip: '不要直接凑近闻化学药品的气味，应该用手轻轻扇动，使少量气体飘进鼻孔。'
                    },
                    {
                        id: 12,
                        type: 'correct',
                        name: '报告老师',
                        icon: 'fas fa-teacher',
                        image: 'https://s.coze.cn/image/YrgfVG8Ub_k/',
                        tip: '如果发生意外或不确定如何操作，要立即报告老师，不要自行处理。'
                    }
                ]
            },
            {
                level: 5,
                question: "在实验室里，以下哪些是正确的安全操作？",
                elements: [
                    {
                        id: 13,
                        type: 'wrong',
                        name: '用湿手碰电源',
                        icon: 'fas fa-bolt',
                        image: 'https://s.coze.cn/image/QQDS-eFU9Y4/',
                        tip: '不要用湿手触摸电源插座或电器设备，以免发生触电危险。'
                    },
                    {
                        id: 14,
                        type: 'correct',
                        name: '正确存放实验器材',
                        icon: 'fas fa-archive',
                        image: 'https://s.coze.cn/image/ldCjmy6D-0w/',
                        tip: '实验结束后，要将实验器材清洗干净并放回指定位置，保持实验室整洁。'
                    },
                    {
                        id: 15,
                        type: 'correct',
                        name: '了解安全出口',
                        icon: 'fas fa-door-open',
                        image: 'https://s.coze.cn/image/LTPGii-5LhA/',
                        tip: '进入实验室后，要先了解安全出口的位置，以便在紧急情况下能够迅速撤离。'
                    }
                ]
            }
        ];
        
        // 游戏状态
        let currentLevel = 0;
        let score = 0;
        let selectedElements = []; // 改为数组存储多项选择
        let totalLevels = gameData.length;
        
        // DOM元素
        const startModal = document.getElementById('startModal');
        const endModal = document.getElementById('endModal');
        const startGameBtn = document.getElementById('startGameBtn');
        const restartGameBtn = document.getElementById('restartGameBtn');
        const scoreElement = document.getElementById('score');
        const currentLevelElement = document.getElementById('currentLevel');
        const progressBar = document.getElementById('progressBar');
        const safetyTip = document.getElementById('safetyTip');
        const characterDialog = document.getElementById('characterDialog');
        const gameElementsContainer = document.querySelector('.game-container .grid');
        const finalScore = document.getElementById('finalScore');
        const resultMessage = document.getElementById('resultMessage');
        const stars = document.getElementById('stars');
        const confirmBtn = document.getElementById('confirmBtn');
        
        // 游戏初始化
        function initGame() {
            currentLevel = 0;
            score = 0;
            selectedElements = []; // 初始化多项选择数组
            updateScore();
            updateLevel();
            updateProgressBar();
            loadLevel(currentLevel);
            confirmBtn.disabled = true;
        }
        
        // 加载关卡
        function loadLevel(levelIndex) {
            const level = gameData[levelIndex];
            gameElementsContainer.innerHTML = '';
            
            // 更新角色对话为当前题目
            updateCharacterDialog(level.question);
            
            // 打乱元素顺序
            const shuffledElements = [...level.elements].sort(() => Math.random() - 0.5);
            
            // 创建游戏元素
            shuffledElements.forEach(element => {
                const elementDiv = document.createElement('div');
                elementDiv.className = `game-element rounded-xl p-4 text-center flex flex-col items-center`;
                elementDiv.dataset.id = element.id;
                elementDiv.dataset.type = element.type;
                
                const elementImage = document.createElement('img');
                elementImage.src = element.image;
                elementImage.alt = element.name;
                elementImage.className = 'w-full h-40 object-contain mb-3';
                
                const elementIcon = document.createElement('i');
                elementIcon.className = `fas ${element.icon} text-3xl mb-2 text-blue-500`;
                
                const elementName = document.createElement('h3');
                elementName.className = 'font-bold';
                elementName.textContent = element.name;
                
                elementDiv.appendChild(elementImage);
                elementDiv.appendChild(elementIcon);
                elementDiv.appendChild(elementName);
                
                // 添加点击事件
                elementDiv.addEventListener('click', () => handleElementClick(element, elementDiv));
                
                gameElementsContainer.appendChild(elementDiv);
            });
        }
        
        // 处理元素点击 - 支持多选和取消选择
        function handleElementClick(element, elementDiv) {
            // 检查元素是否已被选中
            const elementIndex = selectedElements.findIndex(el => el.id === element.id);
            
            if (elementIndex > -1) {
                // 如果已选中，则取消选择
                selectedElements.splice(elementIndex, 1);
                elementDiv.classList.remove('selected');
                elementDiv.querySelector('i').className = `fas ${element.icon} text-3xl mb-2 text-blue-500`;
            } else {
                // 如果未选中，则添加到选择列表
                selectedElements.push(element);
                elementDiv.classList.add('selected');
                elementDiv.querySelector('i').className = `fas ${element.icon} text-3xl mb-2 text-indigo-600`;
            }
            
            // 更新安全提示（如果有选择项，显示最后一个选择项的提示）
            if (selectedElements.length > 0) {
                updateSafetyTip(selectedElements[selectedElements.length - 1].tip);
            } else {
                updateSafetyTip('点击实验室中的物品，学习安全知识！');
            }
            
            // 根据是否有选择项启用/禁用确认按钮
            confirmBtn.disabled = selectedElements.length === 0;
        }
        
        // 处理确认按钮点击
        function handleConfirmClick() {
            if (selectedElements.length === 0) return;
            
            // 禁用确认按钮
            confirmBtn.disabled = true;
            
            // 获取所有游戏元素
            const allElements = document.querySelectorAll('.game-element');
            
            // 显示所有元素的正确/错误状态
            allElements.forEach(el => {
                const elementId = parseInt(el.dataset.id);
                const elementType = el.dataset.type;
                
                // 找到对应的元素数据
                const elementData = gameData[currentLevel].elements.find(e => e.id === elementId);
                
                if (elementType === 'correct') {
                    el.classList.add('correct');
                    el.querySelector('i').className = `fas ${elementData.icon} text-3xl mb-2 text-green-500`;
                } else {
                    el.classList.add('wrong');
                    el.querySelector('i').className = `fas ${elementData.icon} text-3xl mb-2 text-red-500`;
                }
            });
            
            // 判断用户选择是否完全正确
            const currentLevelData = gameData[currentLevel];
            const correctElements = currentLevelData.elements.filter(el => el.type === 'correct');
            const correctSelected = selectedElements.filter(el => el.type === 'correct');
            const wrongSelected = selectedElements.filter(el => el.type === 'wrong');
            
            // 计算得分
            let scoreChange = 0;
            
            // 每选对一个正确选项加10分
            scoreChange += correctSelected.length * 10;
            
            // 每选错一个错误选项扣5分
            scoreChange -= wrongSelected.length * 5;
            
            // 确保分数不低于0
            score = Math.max(0, score + scoreChange);
            
            // 更新角色对话
            if (correctSelected.length === correctElements.length && wrongSelected.length === 0) {
                updateCharacterDialog('太棒了！你全部答对了！');
                showFeedback('correct');
            } else if (correctSelected.length > 0 && wrongSelected.length === 0) {
                updateCharacterDialog('不错！你答对了一部分！');
                showFeedback('partial');
            } else {
                updateCharacterDialog('要小心！有些选项是错误的！');
                showFeedback('wrong');
            }
            
            updateScore();
            
            // 延迟进入下一关
            setTimeout(() => {
                currentLevel++;
                if (currentLevel < totalLevels) {
                    selectedElements = []; // 清空选择列表
                    updateLevel();
                    updateProgressBar();
                    loadLevel(currentLevel);
                } else {
                    // 游戏结束
                    endGame();
                }
            }, 2000);
        }
        
        // 显示反馈动画
        function showFeedback(type) {
            const feedback = document.createElement('div');
            feedback.className = `fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-6xl z-50 animate-bounce`;
            
            if (type === 'correct') {
                feedback.innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
            } else if (type === 'partial') {
                feedback.innerHTML = '<i class="fas fa-check-double text-yellow-500"></i>';
            } else {
                feedback.innerHTML = '<i class="fas fa-times-circle text-red-500"></i>';
            }
            
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.remove();
            }, 1000);
        }
        
        // 更新得分
        function updateScore() {
            scoreElement.textContent = score;
        }
        
        // 更新关卡
        function updateLevel() {
            currentLevelElement.textContent = currentLevel + 1;
        }
        
        // 更新进度条
        function updateProgressBar() {
            const progress = ((currentLevel + 1) / totalLevels) * 100;
            progressBar.style.width = `${progress}%`;
        }
        
        // 更新安全提示
        function updateSafetyTip(tip) {
            safetyTip.textContent = tip;
        }
        
        // 更新角色对话
        function updateCharacterDialog(message) {
            characterDialog.textContent = message;
        }
        
        // 游戏结束
        function endGame() {
            finalScore.textContent = `得分: ${score}`;
            
            // 根据得分显示星星
            stars.innerHTML = '';
            let starCount = 0;
            
            if (score >= 120) {
                starCount = 5;
                resultMessage.textContent = '太棒了！你是实验室安全小专家！';
            } else if (score >= 90) {
                starCount = 4;
                resultMessage.textContent = '非常好！你掌握了大部分安全知识！';
            } else if (score >= 60) {
                starCount = 3;
                resultMessage.textContent = '不错！继续努力学习更多安全知识！';
            } else if (score >= 30) {
                starCount = 2;
                resultMessage.textContent = '加油！还有一些安全知识需要学习！';
            } else {
                starCount = 1;
                resultMessage.textContent = '别灰心！多练习就能掌握安全知识！';
            }
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('i');
                star.className = 'star fas fa-star';
                stars.appendChild(star);
            }
            
            // 显示结束模态框
            endModal.classList.add('active');
        }
        
        // 事件监听器
        startGameBtn.addEventListener('click', () => {
            startModal.classList.remove('active');
            initGame();
        });
        
        restartGameBtn.addEventListener('click', () => {
            endModal.classList.remove('active');
            initGame();
        });
        
        confirmBtn.addEventListener('click', handleConfirmClick);
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            // 页面加载完成后初始化游戏数据
            console.log('游戏数据已加载，共', totalLevels, '个关卡');
        });
    </script>
</body>
</html>
